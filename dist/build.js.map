{"version":3,"sources":["node_modules/browser-pack/_prelude.js","js/dbhelper.js","js/main.js","node_modules/lozad/dist/lozad.js"],"names":[],"mappings":"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CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"build.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","export default class DbHelper {\r\n\r\n  /**\r\n   * Database URL.\r\n   * Change this to restaurants.json file location on your server.\r\n   */\r\n  static get DATABASE_URL() {\r\n    const port = 1337 // Change this to your server port\r\n    return `http://localhost:${port}/restaurants`;\r\n  }\r\n\r\n  /**\r\n   * Fetch all restaurants.\r\n   */\r\n  static fetchRestaurants(callback) {\r\n    fetch(DbHelper.DATABASE_URL)\r\n      .then(res => {\r\n        return res.json()\r\n      })\r\n      .then(restaurants => {\r\n        callback(null, restaurants);\r\n      })\r\n      .catch(e => {\r\n        const error = (`Request failed. Returned status of ${e}`);\r\n        callback(error, null);\r\n      })\r\n  }\r\n\r\n  /**\r\n   * Fetch a restaurant by its ID.\r\n   */\r\n  static fetchRestaurantById(id, callback) {\r\n    // fetch all restaurants with proper error handling.\r\n    fetch(`${DbHelper.DATABASE_URL}/${id}`)\r\n      .then(res => res.json())\r\n      .then(restaurant => {\r\n        callback(null, restaurant);\r\n      })\r\n      .catch(() => {\r\n        callback('Restaurant does not exist', null);\r\n      })\r\n  }\r\n\r\n  /**\r\n   * Fetch restaurants by a cuisine type with proper error handling.\r\n   */\r\n  static fetchRestaurantByCuisine(cuisine, callback) {\r\n    // Fetch all restaurants  with proper error handling\r\n    DbHelper.fetchRestaurants((error, restaurants) => {\r\n      if (error) {\r\n        callback(error, null);\r\n      } else {\r\n        // Filter restaurants to have only given cuisine type\r\n        const results = restaurants.filter(r => r.cuisine_type == cuisine);\r\n        callback(null, results);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Fetch restaurants by a neighborhood with proper error handling.\r\n   */\r\n  static fetchRestaurantByNeighborhood(neighborhood, callback) {\r\n    // Fetch all restaurants\r\n    DbHelper.fetchRestaurants((error, restaurants) => {\r\n      if (error) {\r\n        callback(error, null);\r\n      } else {\r\n        // Filter restaurants to have only given neighborhood\r\n        const results = restaurants.filter(r => r.neighborhood == neighborhood);\r\n        callback(null, results);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Fetch restaurants by a cuisine and a neighborhood with proper error handling.\r\n   */\r\n  static fetchRestaurantByCuisineAndNeighborhood(cuisine, neighborhood, callback) {\r\n    // Fetch all restaurants\r\n    DbHelper.fetchRestaurants((error, restaurants) => {\r\n      if (error) {\r\n        callback(error, null);\r\n      } else {\r\n        let results = restaurants\r\n        if (cuisine != 'all') { // filter by cuisine\r\n          results = results.filter(r => r.cuisine_type == cuisine);\r\n        }\r\n        if (neighborhood != 'all') { // filter by neighborhood\r\n          results = results.filter(r => r.neighborhood == neighborhood);\r\n        }\r\n        callback(null, results);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Fetch all neighborhoods with proper error handling.\r\n   */\r\n  static fetchNeighborhoods(callback) {\r\n    // Fetch all restaurants\r\n    DbHelper.fetchRestaurants((error, restaurants) => {\r\n      if (error) {\r\n        callback(error, null);\r\n      } else {\r\n        // Get all neighborhoods from all restaurants\r\n        const neighborhoods = restaurants.map((v, i) => restaurants[i].neighborhood)\r\n        // Remove duplicates from neighborhoods\r\n        const uniqueNeighborhoods = neighborhoods.filter((v, i) => neighborhoods.indexOf(v) == i)\r\n        callback(null, uniqueNeighborhoods);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Fetch all cuisines with proper error handling.\r\n   */\r\n  static fetchCuisines(callback) {\r\n    // Fetch all restaurants\r\n    DbHelper.fetchRestaurants((error, restaurants) => {\r\n      if (error) {\r\n        callback(error, null);\r\n      } else {\r\n        // Get all cuisines from all restaurants\r\n        const cuisines = restaurants.map((v, i) => restaurants[i].cuisine_type)\r\n        // Remove duplicates from cuisines\r\n        const uniqueCuisines = cuisines.filter((v, i) => cuisines.indexOf(v) == i)\r\n        callback(null, uniqueCuisines);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Restaurant page URL.\r\n   */\r\n  static urlForRestaurant(restaurant) {\r\n    return (`./restaurant.html?id=${restaurant.id}`);\r\n  }\r\n\r\n  /**\r\n   * Restaurant image URL.\r\n   */\r\n  static imageUrlForRestaurant(restaurant) {\r\n    return (`/dist/images/${restaurant.photograph}.jpg`);\r\n  }\r\n\r\n  /**\r\n   * Map marker for a restaurant.\r\n   */\r\n  static mapMarkerForRestaurant(restaurant, map) {\r\n    const marker = new google.maps.Marker({\r\n      position: restaurant.latlng,\r\n      title: restaurant.name,\r\n      url: DbHelper.urlForRestaurant(restaurant),\r\n      map: map,\r\n      animation: google.maps.Animation.DROP}\r\n    );\r\n    return marker;\r\n  }\r\n\r\n}\r\n","import DbHelper from './dbhelper';\r\nimport lozad from 'lozad';\r\n\r\nlet restaurants,\r\n  neighborhoods,\r\n  cuisines\r\nvar map\r\n\r\nconst observer = lozad(); // lazy loads elements with default selector as '.lozad'\r\nlet loc = {\r\n  lat: 40.722216,\r\n  lng: -73.987501\r\n};\r\nlet self = {\r\n  markers: []\r\n};\r\n\r\nconst registerServiceWorker = () => {\r\n  if(!navigator.serviceWorker) return;\r\n\r\n  navigator.serviceWorker.register('/build_sw.js').then(function(reg) {\r\n    if (!navigator.serviceWorker.controller) {\r\n        return;\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Fetch all neighborhoods and set their HTML.\r\n */\r\nconst fetchNeighborhoods = () => {\r\n  DbHelper.fetchNeighborhoods((error, neighborhoods) => {\r\n    if (error) { // Got an error\r\n      console.error(error);\r\n    } else {\r\n      self.neighborhoods = neighborhoods;\r\n      fillNeighborhoodsHTML();\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Set neighborhoods HTML.\r\n */\r\nconst fillNeighborhoodsHTML = (neighborhoods = self.neighborhoods) => {\r\n  const select = document.getElementById('neighborhoods-select');\r\n  neighborhoods.forEach(neighborhood => {\r\n    const option = document.createElement('option');\r\n    option.innerHTML = neighborhood;\r\n    option.value = neighborhood;\r\n    select.append(option);\r\n\r\n    observer.observe();\r\n  });\r\n}\r\n\r\n/**\r\n * Fetch all cuisines and set their HTML.\r\n */\r\nconst fetchCuisines = () => {\r\n  DbHelper.fetchCuisines((error, cuisines) => {\r\n    if (error) { // Got an error!\r\n      console.error(error);\r\n    } else {\r\n      self.cuisines = cuisines;\r\n      fillCuisinesHTML();\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Set cuisines HTML.\r\n */\r\nconst fillCuisinesHTML = (cuisines = self.cuisines) => {\r\n  const select = document.getElementById('cuisines-select');\r\n  \r\n  cuisines.forEach(cuisine => {\r\n    const option = document.createElement('option');\r\n    option.innerHTML = cuisine;\r\n    option.value = cuisine;\r\n    select.append(option);\r\n  });\r\n}\r\n\r\n\r\n/**\r\n * Update page and map for current restaurants.\r\n */\r\nconst updateRestaurants = () => {\r\n  const cSelect = document.getElementById('cuisines-select');\r\n  const nSelect = document.getElementById('neighborhoods-select');\r\n\r\n  const cIndex = cSelect.selectedIndex;\r\n  const nIndex = nSelect.selectedIndex;\r\n\r\n  const cuisine = cSelect[cIndex].value;\r\n  const neighborhood = nSelect[nIndex].value;\r\n  DbHelper.fetchRestaurantByCuisineAndNeighborhood(cuisine, neighborhood, (error, restaurants) => {\r\n    if (error) { // Got an error!\r\n      console.error(error);\r\n    } else {\r\n      resetRestaurants(restaurants);\r\n      fillRestaurantsHTML();\r\n    }\r\n  })\r\n}\r\n\r\n/**\r\n * Clear current restaurants, their HTML and remove their map markers.\r\n */\r\nconst resetRestaurants = (restaurants) => {\r\n  // Remove all restaurants\r\n  self.restaurants = [];\r\n  const ul = document.getElementById('restaurants-list');\r\n  ul.innerHTML = '';\r\n  \r\n  // Remove all map markers\r\n  self.markers.forEach(m => m.setMap(null));\r\n  self.markers = [];\r\n  self.restaurants = restaurants;\r\n}\r\n\r\n/**\r\n * Create all restaurants HTML and add them to the webpage.\r\n */\r\nconst fillRestaurantsHTML = (restaurants = self.restaurants) => {\r\n  const ul = document.getElementById('restaurants-list');\r\n  restaurants.forEach(restaurant => {\r\n    ul.append(createRestaurantHTML(restaurant));\r\n  });\r\n  observer.observe();\r\n  addMarkersToMap();\r\n}\r\n\r\n/**\r\n * Create restaurant HTML.\r\n */\r\nconst createRestaurantHTML = (restaurant) => {\r\n  const li = document.createElement('li');\r\n  \r\n  const image = document.createElement('img');\r\n  image.className = 'restaurant-img lozad';\r\n  image.setAttribute('data-src', DbHelper.imageUrlForRestaurant(restaurant));\r\n  image.alt = `Image of a restaurant called ${restaurant.name}`;\r\n  li.append(image);\r\n  \r\n  const name = document.createElement('h2');\r\n  name.innerHTML = restaurant.name;\r\n  li.append(name);\r\n  \r\n  const neighborhood = document.createElement('p');\r\n  neighborhood.innerHTML = restaurant.neighborhood;\r\n  li.append(neighborhood);\r\n  \r\n  const address = document.createElement('p');\r\n  address.innerHTML = restaurant.address;\r\n  li.append(address);\r\n  \r\n  const more = document.createElement('a');\r\n  more.innerHTML = 'View Details';\r\n  more.href = DbHelper.urlForRestaurant(restaurant);\r\n  li.append(more)\r\n  \r\n  return li\r\n}\r\n\r\n/**\r\n * Add markers for current restaurants to the map.\r\n */\r\nconst addMarkersToMap = (restaurants = self.restaurants) => {\r\n  restaurants.forEach(restaurant => {\r\n    // Add marker to the map\r\n    const marker = DbHelper.mapMarkerForRestaurant(restaurant, self.map);\r\n    google.maps.event.addListener(marker, 'click', () => {\r\n      window.location.href = marker.url\r\n    });\r\n    self.markers.push(marker);\r\n  });\r\n\r\n  const markers = restaurants.map(restaurant => restaurant.latlng)\r\n  updateMapPicture(markers)\r\n}\r\nconst updateMapPicture = (markers) => {\r\n  console.log(markers)\r\n  const url = `https://maps.googleapis.com/maps/api/staticmap?\r\n  center=${loc.lat}, ${loc.lng}\r\n  &zoom=12\r\n  &size=2400x2400\r\n  &maptype=roadmap\r\n  ${markers ? markers.map(marker => `&markers=color:red%7C${marker.lat},${marker.lng}`).join('') : ''}\r\n  &key=AIzaSyAXlOTPzwGrGLlSNT9IpeYO9oTzeFPZ7a0`\r\n\r\n  let img = document.createElement('img');\r\n  img.src = url\r\n  img.style['height']='100%'\r\n  img.style['width']='100%'\r\n  img.style['object-fit']='cover'\r\n\r\n  const map = document.querySelector('#map')\r\n  map.innerHTML = ''\r\n  map.appendChild(img)\r\n}\r\n/**\r\n * Initialize Google map, called from HTML.\r\n */\r\nwindow.initMap = () => {\r\n  \r\n  // self.map = new google.maps.Map(document.getElementById('map'), {\r\n  //   zoom: 12,\r\n  //   center: loc,\r\n  //   scrollwheel: false\r\n  // });\r\n\r\n  updateMapPicture();\r\n\r\n  updateRestaurants();\r\n}\r\n\r\n/**\r\n * Fetch neighborhoods and cuisines as soon as the page is loaded.\r\n */\r\ndocument.addEventListener('DOMContentLoaded', (event) => {\r\n  window.updateRestaurants = updateRestaurants;\r\n  registerServiceWorker();\r\n  fetchNeighborhoods();\r\n  fetchCuisines();\r\n  \r\n  observer.observe();\r\n});","/*! lozad.js - v1.4.0 - 2018-04-22\n* https://github.com/ApoorvSaxena/lozad.js\n* Copyright (c) 2018 Apoorv Saxena; Licensed MIT */\n\n\n(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n\ttypeof define === 'function' && define.amd ? define(factory) :\n\t(global.lozad = factory());\n}(this, (function () { 'use strict';\n\nvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\n/**\n * Detect IE browser\n * @const {boolean}\n * @private\n */\nvar isIE = document.documentMode;\n\nvar defaultConfig = {\n  rootMargin: '0px',\n  threshold: 0,\n  load: function load(element) {\n    if (element.nodeName.toLowerCase() === 'picture') {\n      var img = document.createElement('img');\n      if (isIE && element.getAttribute('data-iesrc')) {\n        img.src = element.getAttribute('data-iesrc');\n      }\n      element.appendChild(img);\n    }\n    if (element.getAttribute('data-src')) {\n      element.src = element.getAttribute('data-src');\n    }\n    if (element.getAttribute('data-srcset')) {\n      element.srcset = element.getAttribute('data-srcset');\n    }\n    if (element.getAttribute('data-background-image')) {\n      element.style.backgroundImage = 'url(\\'' + element.getAttribute('data-background-image') + '\\')';\n    }\n  },\n  loaded: function loaded() {}\n};\n\nfunction markAsLoaded(element) {\n  element.setAttribute('data-loaded', true);\n}\n\nvar isLoaded = function isLoaded(element) {\n  return element.getAttribute('data-loaded') === 'true';\n};\n\nvar onIntersection = function onIntersection(load, loaded) {\n  return function (entries, observer) {\n    entries.forEach(function (entry) {\n      if (entry.intersectionRatio > 0) {\n        observer.unobserve(entry.target);\n\n        if (!isLoaded(entry.target)) {\n          load(entry.target);\n          markAsLoaded(entry.target);\n          loaded(entry.target);\n        }\n      }\n    });\n  };\n};\n\nvar getElements = function getElements(selector) {\n  if (selector instanceof Element) {\n    return [selector];\n  }\n  if (selector instanceof NodeList) {\n    return selector;\n  }\n  return document.querySelectorAll(selector);\n};\n\nvar lozad = function () {\n  var selector = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '.lozad';\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n  var _defaultConfig$option = _extends({}, defaultConfig, options),\n      rootMargin = _defaultConfig$option.rootMargin,\n      threshold = _defaultConfig$option.threshold,\n      load = _defaultConfig$option.load,\n      loaded = _defaultConfig$option.loaded;\n\n  var observer = void 0;\n\n  if (window.IntersectionObserver) {\n    observer = new IntersectionObserver(onIntersection(load, loaded), {\n      rootMargin: rootMargin,\n      threshold: threshold\n    });\n  }\n\n  return {\n    observe: function observe() {\n      var elements = getElements(selector);\n\n      for (var i = 0; i < elements.length; i++) {\n        if (isLoaded(elements[i])) {\n          continue;\n        }\n        if (observer) {\n          observer.observe(elements[i]);\n          continue;\n        }\n        load(elements[i]);\n        markAsLoaded(elements[i]);\n        loaded(elements[i]);\n      }\n    },\n    triggerLoad: function triggerLoad(element) {\n      if (isLoaded(element)) {\n        return;\n      }\n\n      load(element);\n      markAsLoaded(element);\n      loaded(element);\n    }\n  };\n};\n\nreturn lozad;\n\n})));\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJqcy9kYmhlbHBlci5qcyIsImpzL21haW4uanMiLCJub2RlX21vZHVsZXMvbG96YWQvZGlzdC9sb3phZC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7SUNBcUIsUTs7Ozs7Ozs7O0FBV25COzs7cUNBR3dCLFEsRUFBVTtBQUNoQyxZQUFNLFNBQVMsWUFBZixFQUNHLElBREgsQ0FDUSxlQUFPO0FBQ1gsZUFBTyxJQUFJLElBQUosRUFBUDtBQUNELE9BSEgsRUFJRyxJQUpILENBSVEsdUJBQWU7QUFDbkIsaUJBQVMsSUFBVCxFQUFlLFdBQWY7QUFDRCxPQU5ILEVBT0csS0FQSCxDQU9TLGFBQUs7QUFDVixZQUFNLGdEQUErQyxDQUFyRDtBQUNBLGlCQUFTLEtBQVQsRUFBZ0IsSUFBaEI7QUFDRCxPQVZIO0FBV0Q7O0FBRUQ7Ozs7Ozt3Q0FHMkIsRSxFQUFJLFEsRUFBVTtBQUN2QztBQUNBLFlBQVMsU0FBUyxZQUFsQixTQUFrQyxFQUFsQyxFQUNHLElBREgsQ0FDUTtBQUFBLGVBQU8sSUFBSSxJQUFKLEVBQVA7QUFBQSxPQURSLEVBRUcsSUFGSCxDQUVRLHNCQUFjO0FBQ2xCLGlCQUFTLElBQVQsRUFBZSxVQUFmO0FBQ0QsT0FKSCxFQUtHLEtBTEgsQ0FLUyxZQUFNO0FBQ1gsaUJBQVMsMkJBQVQsRUFBc0MsSUFBdEM7QUFDRCxPQVBIO0FBUUQ7O0FBRUQ7Ozs7Ozs2Q0FHZ0MsTyxFQUFTLFEsRUFBVTtBQUNqRDtBQUNBLGVBQVMsZ0JBQVQsQ0FBMEIsVUFBQyxLQUFELEVBQVEsV0FBUixFQUF3QjtBQUNoRCxZQUFJLEtBQUosRUFBVztBQUNULG1CQUFTLEtBQVQsRUFBZ0IsSUFBaEI7QUFDRCxTQUZELE1BRU87QUFDTDtBQUNBLGNBQU0sVUFBVSxZQUFZLE1BQVosQ0FBbUI7QUFBQSxtQkFBSyxFQUFFLFlBQUYsSUFBa0IsT0FBdkI7QUFBQSxXQUFuQixD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QUVBO0FBQ0QsQ0FYRDs7QUFhQTs7O0FBR0EsU0FBUyxnQkFBVCxDQUEwQixrQkFBMUIsRUFBOEMsVUFBQyxLQUFELEVBQVc7QUFDdkQsU0FBTyxpQkFBUCxHQUEyQixpQkFBM0I7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsV0FBUyxPQUFUO0FBQ0QsQ0FQRDs7O0FDN05BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtmdW5jdGlvbiByKGUsbix0KXtmdW5jdGlvbiBvKGksZil7aWYoIW5baV0pe2lmKCFlW2ldKXt2YXIgYz1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCFmJiZjKXJldHVybiBjKGksITApO2lmKHUpcmV0dXJuIHUoaSwhMCk7dmFyIGE9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitpK1wiJ1wiKTt0aHJvdyBhLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsYX12YXIgcD1uW2ldPXtleHBvcnRzOnt9fTtlW2ldWzBdLmNhbGwocC5leHBvcnRzLGZ1bmN0aW9uKHIpe3ZhciBuPWVbaV1bMV1bcl07cmV0dXJuIG8obnx8cil9LHAscC5leHBvcnRzLHIsZSxuLHQpfXJldHVybiBuW2ldLmV4cG9ydHN9Zm9yKHZhciB1PVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsaT0wO2k8dC5sZW5ndGg7aSsrKW8odFtpXSk7cmV0dXJuIG99cmV0dXJuIHJ9KSgpIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgRGJIZWxwZXIge1xyXG5cclxuICAvKipcclxuICAgKiBEYXRhYmFzZSBVUkwuXHJcbiAgICogQ2hhbmdlIHRoaXMgdG8gcmVzdGF1cmFudHMuanNvbiBmaWxlIGxvY2F0aW9uIG9uIHlvdXIgc2VydmVyLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBnZXQgREFUQUJBU0VfVVJMKCkge1xyXG4gICAgY29uc3QgcG9ydCA9IDEzMzcgLy8gQ2hhbmdlIHRoaXMgdG8geW91ciBzZXJ2ZXIgcG9ydFxyXG4gICAgcmV0dXJuIGBodHRwOi8vbG9jYWxob3N0OiR7cG9ydH0vcmVzdGF1cmFudHNgO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIHJlc3RhdXJhbnRzLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRzKGNhbGxiYWNrKSB7XHJcbiAgICBmZXRjaChEYkhlbHBlci5EQVRBQkFTRV9VUkwpXHJcbiAgICAgIC50aGVuKHJlcyA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKClcclxuICAgICAgfSlcclxuICAgICAgLnRoZW4ocmVzdGF1cmFudHMgPT4ge1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnRzKTtcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKGUgPT4ge1xyXG4gICAgICAgIGNvbnN0IGVycm9yID0gKGBSZXF1ZXN0IGZhaWxlZC4gUmV0dXJuZWQgc3RhdHVzIG9mICR7ZX1gKTtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0pXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhIHJlc3RhdXJhbnQgYnkgaXRzIElELlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUlkKGlkLCBjYWxsYmFjaykge1xyXG4gICAgLy8gZmV0Y2ggYWxsIHJlc3RhdXJhbnRzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAgZmV0Y2goYCR7RGJIZWxwZXIuREFUQUJBU0VfVVJMfS8ke2lkfWApXHJcbiAgICAgIC50aGVuKHJlcyA9PiByZXMuanNvbigpKVxyXG4gICAgICAudGhlbihyZXN0YXVyYW50ID0+IHtcclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50KTtcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKCgpID0+IHtcclxuICAgICAgICBjYWxsYmFjaygnUmVzdGF1cmFudCBkb2VzIG5vdCBleGlzdCcsIG51bGwpO1xyXG4gICAgICB9KVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIHR5cGUgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZShjdWlzaW5lLCBjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzICB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZ1xyXG4gICAgRGJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIGN1aXNpbmUgdHlwZVxyXG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSByZXN0YXVyYW50cy5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIG5laWdoYm9yaG9vZCB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlOZWlnaGJvcmhvb2QobmVpZ2hib3Job29kLCBjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICBEYkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEZpbHRlciByZXN0YXVyYW50cyB0byBoYXZlIG9ubHkgZ2l2ZW4gbmVpZ2hib3Job29kXHJcbiAgICAgICAgY29uc3QgcmVzdWx0cyA9IHJlc3RhdXJhbnRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIGFuZCBhIG5laWdoYm9yaG9vZCB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kKGN1aXNpbmUsIG5laWdoYm9yaG9vZCwgY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgRGJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBsZXQgcmVzdWx0cyA9IHJlc3RhdXJhbnRzXHJcbiAgICAgICAgaWYgKGN1aXNpbmUgIT0gJ2FsbCcpIHsgLy8gZmlsdGVyIGJ5IGN1aXNpbmVcclxuICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobmVpZ2hib3Job29kICE9ICdhbGwnKSB7IC8vIGZpbHRlciBieSBuZWlnaGJvcmhvb2RcclxuICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaE5laWdoYm9yaG9vZHMoY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgRGJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBHZXQgYWxsIG5laWdoYm9yaG9vZHMgZnJvbSBhbGwgcmVzdGF1cmFudHNcclxuICAgICAgICBjb25zdCBuZWlnaGJvcmhvb2RzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5uZWlnaGJvcmhvb2QpXHJcbiAgICAgICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBuZWlnaGJvcmhvb2RzXHJcbiAgICAgICAgY29uc3QgdW5pcXVlTmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHMuZmlsdGVyKCh2LCBpKSA9PiBuZWlnaGJvcmhvb2RzLmluZGV4T2YodikgPT0gaSlcclxuICAgICAgICBjYWxsYmFjayhudWxsLCB1bmlxdWVOZWlnaGJvcmhvb2RzKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgY3Vpc2luZXMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoQ3Vpc2luZXMoY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgRGJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBHZXQgYWxsIGN1aXNpbmVzIGZyb20gYWxsIHJlc3RhdXJhbnRzXHJcbiAgICAgICAgY29uc3QgY3Vpc2luZXMgPSByZXN0YXVyYW50cy5tYXAoKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLmN1aXNpbmVfdHlwZSlcclxuICAgICAgICAvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIGN1aXNpbmVzXHJcbiAgICAgICAgY29uc3QgdW5pcXVlQ3Vpc2luZXMgPSBjdWlzaW5lcy5maWx0ZXIoKHYsIGkpID0+IGN1aXNpbmVzLmluZGV4T2YodikgPT0gaSlcclxuICAgICAgICBjYWxsYmFjayhudWxsLCB1bmlxdWVDdWlzaW5lcyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzdGF1cmFudCBwYWdlIFVSTC5cclxuICAgKi9cclxuICBzdGF0aWMgdXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XHJcbiAgICByZXR1cm4gKGAuL3Jlc3RhdXJhbnQuaHRtbD9pZD0ke3Jlc3RhdXJhbnQuaWR9YCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXN0YXVyYW50IGltYWdlIFVSTC5cclxuICAgKi9cclxuICBzdGF0aWMgaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcclxuICAgIHJldHVybiAoYC9kaXN0L2ltYWdlcy8ke3Jlc3RhdXJhbnQucGhvdG9ncmFwaH0uanBnYCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBNYXAgbWFya2VyIGZvciBhIHJlc3RhdXJhbnQuXHJcbiAgICovXHJcbiAgc3RhdGljIG1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgbWFwKSB7XHJcbiAgICBjb25zdCBtYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcclxuICAgICAgcG9zaXRpb246IHJlc3RhdXJhbnQubGF0bG5nLFxyXG4gICAgICB0aXRsZTogcmVzdGF1cmFudC5uYW1lLFxyXG4gICAgICB1cmw6IERiSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCksXHJcbiAgICAgIG1hcDogbWFwLFxyXG4gICAgICBhbmltYXRpb246IGdvb2dsZS5tYXBzLkFuaW1hdGlvbi5EUk9QfVxyXG4gICAgKTtcclxuICAgIHJldHVybiBtYXJrZXI7XHJcbiAgfVxyXG5cclxufVxyXG4iLCJpbXBvcnQgRGJIZWxwZXIgZnJvbSAnLi9kYmhlbHBlcic7XHJcbmltcG9ydCBsb3phZCBmcm9tICdsb3phZCc7XHJcblxyXG5sZXQgcmVzdGF1cmFudHMsXHJcbiAgbmVpZ2hib3Job29kcyxcclxuICBjdWlzaW5lc1xyXG52YXIgbWFwXHJcblxyXG5jb25zdCBvYnNlcnZlciA9IGxvemFkKCk7IC8vIGxhenkgbG9hZHMgZWxlbWVudHMgd2l0aCBkZWZhdWx0IHNlbGVjdG9yIGFzICcubG96YWQnXHJcbmxldCBsb2MgPSB7XHJcbiAgbGF0OiA0MC43MjIyMTYsXHJcbiAgbG5nOiAtNzMuOTg3NTAxXHJcbn07XHJcbmxldCBzZWxmID0ge1xyXG4gIG1hcmtlcnM6IFtdXHJcbn07XHJcblxyXG5jb25zdCByZWdpc3RlclNlcnZpY2VXb3JrZXIgPSAoKSA9PiB7XHJcbiAgaWYoIW5hdmlnYXRvci5zZXJ2aWNlV29ya2VyKSByZXR1cm47XHJcblxyXG4gIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlZ2lzdGVyKCcvYnVpbGRfc3cuanMnKS50aGVuKGZ1bmN0aW9uKHJlZykge1xyXG4gICAgaWYgKCFuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5jb250cm9sbGVyKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogRmV0Y2ggYWxsIG5laWdoYm9yaG9vZHMgYW5kIHNldCB0aGVpciBIVE1MLlxyXG4gKi9cclxuY29uc3QgZmV0Y2hOZWlnaGJvcmhvb2RzID0gKCkgPT4ge1xyXG4gIERiSGVscGVyLmZldGNoTmVpZ2hib3Job29kcygoZXJyb3IsIG5laWdoYm9yaG9vZHMpID0+IHtcclxuICAgIGlmIChlcnJvcikgeyAvLyBHb3QgYW4gZXJyb3JcclxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBzZWxmLm5laWdoYm9yaG9vZHMgPSBuZWlnaGJvcmhvb2RzO1xyXG4gICAgICBmaWxsTmVpZ2hib3Job29kc0hUTUwoKTtcclxuICAgIH1cclxuICB9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIFNldCBuZWlnaGJvcmhvb2RzIEhUTUwuXHJcbiAqL1xyXG5jb25zdCBmaWxsTmVpZ2hib3Job29kc0hUTUwgPSAobmVpZ2hib3Job29kcyA9IHNlbGYubmVpZ2hib3Job29kcykgPT4ge1xyXG4gIGNvbnN0IHNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZWlnaGJvcmhvb2RzLXNlbGVjdCcpO1xyXG4gIG5laWdoYm9yaG9vZHMuZm9yRWFjaChuZWlnaGJvcmhvb2QgPT4ge1xyXG4gICAgY29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XHJcbiAgICBvcHRpb24uaW5uZXJIVE1MID0gbmVpZ2hib3Job29kO1xyXG4gICAgb3B0aW9uLnZhbHVlID0gbmVpZ2hib3Job29kO1xyXG4gICAgc2VsZWN0LmFwcGVuZChvcHRpb24pO1xyXG5cclxuICAgIG9ic2VydmVyLm9ic2VydmUoKTtcclxuICB9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEZldGNoIGFsbCBjdWlzaW5lcyBhbmQgc2V0IHRoZWlyIEhUTUwuXHJcbiAqL1xyXG5jb25zdCBmZXRjaEN1aXNpbmVzID0gKCkgPT4ge1xyXG4gIERiSGVscGVyLmZldGNoQ3Vpc2luZXMoKGVycm9yLCBjdWlzaW5lcykgPT4ge1xyXG4gICAgaWYgKGVycm9yKSB7IC8vIEdvdCBhbiBlcnJvciFcclxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBzZWxmLmN1aXNpbmVzID0gY3Vpc2luZXM7XHJcbiAgICAgIGZpbGxDdWlzaW5lc0hUTUwoKTtcclxuICAgIH1cclxuICB9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIFNldCBjdWlzaW5lcyBIVE1MLlxyXG4gKi9cclxuY29uc3QgZmlsbEN1aXNpbmVzSFRNTCA9IChjdWlzaW5lcyA9IHNlbGYuY3Vpc2luZXMpID0+IHtcclxuICBjb25zdCBzZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3Vpc2luZXMtc2VsZWN0Jyk7XHJcbiAgXHJcbiAgY3Vpc2luZXMuZm9yRWFjaChjdWlzaW5lID0+IHtcclxuICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xyXG4gICAgb3B0aW9uLmlubmVySFRNTCA9IGN1aXNpbmU7XHJcbiAgICBvcHRpb24udmFsdWUgPSBjdWlzaW5lO1xyXG4gICAgc2VsZWN0LmFwcGVuZChvcHRpb24pO1xyXG4gIH0pO1xyXG59XHJcblxyXG5cclxuLyoqXHJcbiAqIFVwZGF0ZSBwYWdlIGFuZCBtYXAgZm9yIGN1cnJlbnQgcmVzdGF1cmFudHMuXHJcbiAqL1xyXG5jb25zdCB1cGRhdGVSZXN0YXVyYW50cyA9ICgpID0+IHtcclxuICBjb25zdCBjU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1aXNpbmVzLXNlbGVjdCcpO1xyXG4gIGNvbnN0IG5TZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmVpZ2hib3Job29kcy1zZWxlY3QnKTtcclxuXHJcbiAgY29uc3QgY0luZGV4ID0gY1NlbGVjdC5zZWxlY3RlZEluZGV4O1xyXG4gIGNvbnN0IG5JbmRleCA9IG5TZWxlY3Quc2VsZWN0ZWRJbmRleDtcclxuXHJcbiAgY29uc3QgY3Vpc2luZSA9IGNTZWxlY3RbY0luZGV4XS52YWx1ZTtcclxuICBjb25zdCBuZWlnaGJvcmhvb2QgPSBuU2VsZWN0W25JbmRleF0udmFsdWU7XHJcbiAgRGJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kKGN1aXNpbmUsIG5laWdoYm9yaG9vZCwgKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgaWYgKGVycm9yKSB7IC8vIEdvdCBhbiBlcnJvciFcclxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXNldFJlc3RhdXJhbnRzKHJlc3RhdXJhbnRzKTtcclxuICAgICAgZmlsbFJlc3RhdXJhbnRzSFRNTCgpO1xyXG4gICAgfVxyXG4gIH0pXHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDbGVhciBjdXJyZW50IHJlc3RhdXJhbnRzLCB0aGVpciBIVE1MIGFuZCByZW1vdmUgdGhlaXIgbWFwIG1hcmtlcnMuXHJcbiAqL1xyXG5jb25zdCByZXNldFJlc3RhdXJhbnRzID0gKHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgLy8gUmVtb3ZlIGFsbCByZXN0YXVyYW50c1xyXG4gIHNlbGYucmVzdGF1cmFudHMgPSBbXTtcclxuICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50cy1saXN0Jyk7XHJcbiAgdWwuaW5uZXJIVE1MID0gJyc7XHJcbiAgXHJcbiAgLy8gUmVtb3ZlIGFsbCBtYXAgbWFya2Vyc1xyXG4gIHNlbGYubWFya2Vycy5mb3JFYWNoKG0gPT4gbS5zZXRNYXAobnVsbCkpO1xyXG4gIHNlbGYubWFya2VycyA9IFtdO1xyXG4gIHNlbGYucmVzdGF1cmFudHMgPSByZXN0YXVyYW50cztcclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSBhbGwgcmVzdGF1cmFudHMgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXHJcbiAqL1xyXG5jb25zdCBmaWxsUmVzdGF1cmFudHNIVE1MID0gKHJlc3RhdXJhbnRzID0gc2VsZi5yZXN0YXVyYW50cykgPT4ge1xyXG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnRzLWxpc3QnKTtcclxuICByZXN0YXVyYW50cy5mb3JFYWNoKHJlc3RhdXJhbnQgPT4ge1xyXG4gICAgdWwuYXBwZW5kKGNyZWF0ZVJlc3RhdXJhbnRIVE1MKHJlc3RhdXJhbnQpKTtcclxuICB9KTtcclxuICBvYnNlcnZlci5vYnNlcnZlKCk7XHJcbiAgYWRkTWFya2Vyc1RvTWFwKCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBIVE1MLlxyXG4gKi9cclxuY29uc3QgY3JlYXRlUmVzdGF1cmFudEhUTUwgPSAocmVzdGF1cmFudCkgPT4ge1xyXG4gIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcclxuICBcclxuICBjb25zdCBpbWFnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xyXG4gIGltYWdlLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWltZyBsb3phZCc7XHJcbiAgaW1hZ2Uuc2V0QXR0cmlidXRlKCdkYXRhLXNyYycsIERiSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSk7XHJcbiAgaW1hZ2UuYWx0ID0gYEltYWdlIG9mIGEgcmVzdGF1cmFudCBjYWxsZWQgJHtyZXN0YXVyYW50Lm5hbWV9YDtcclxuICBsaS5hcHBlbmQoaW1hZ2UpO1xyXG4gIFxyXG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMicpO1xyXG4gIG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xyXG4gIGxpLmFwcGVuZChuYW1lKTtcclxuICBcclxuICBjb25zdCBuZWlnaGJvcmhvb2QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcbiAgbmVpZ2hib3Job29kLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmVpZ2hib3Job29kO1xyXG4gIGxpLmFwcGVuZChuZWlnaGJvcmhvb2QpO1xyXG4gIFxyXG4gIGNvbnN0IGFkZHJlc3MgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcbiAgYWRkcmVzcy5pbm5lckhUTUwgPSByZXN0YXVyYW50LmFkZHJlc3M7XHJcbiAgbGkuYXBwZW5kKGFkZHJlc3MpO1xyXG4gIFxyXG4gIGNvbnN0IG1vcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XHJcbiAgbW9yZS5pbm5lckhUTUwgPSAnVmlldyBEZXRhaWxzJztcclxuICBtb3JlLmhyZWYgPSBEYkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xyXG4gIGxpLmFwcGVuZChtb3JlKVxyXG4gIFxyXG4gIHJldHVybiBsaVxyXG59XHJcblxyXG4vKipcclxuICogQWRkIG1hcmtlcnMgZm9yIGN1cnJlbnQgcmVzdGF1cmFudHMgdG8gdGhlIG1hcC5cclxuICovXHJcbmNvbnN0IGFkZE1hcmtlcnNUb01hcCA9IChyZXN0YXVyYW50cyA9IHNlbGYucmVzdGF1cmFudHMpID0+IHtcclxuICByZXN0YXVyYW50cy5mb3JFYWNoKHJlc3RhdXJhbnQgPT4ge1xyXG4gICAgLy8gQWRkIG1hcmtlciB0byB0aGUgbWFwXHJcbiAgICBjb25zdCBtYXJrZXIgPSBEYkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIHNlbGYubWFwKTtcclxuICAgIGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcmtlciwgJ2NsaWNrJywgKCkgPT4ge1xyXG4gICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IG1hcmtlci51cmxcclxuICAgIH0pO1xyXG4gICAgc2VsZi5tYXJrZXJzLnB1c2gobWFya2VyKTtcclxuICB9KTtcclxuXHJcbiAgY29uc3QgbWFya2VycyA9IHJlc3RhdXJhbnRzLm1hcChyZXN0YXVyYW50ID0+IHJlc3RhdXJhbnQubGF0bG5nKVxyXG4gIHVwZGF0ZU1hcFBpY3R1cmUobWFya2VycylcclxufVxyXG5jb25zdCB1cGRhdGVNYXBQaWN0dXJlID0gKG1hcmtlcnMpID0+IHtcclxuICBjb25zb2xlLmxvZyhtYXJrZXJzKVxyXG4gIGNvbnN0IHVybCA9IGBodHRwczovL21hcHMuZ29vZ2xlYXBpcy5jb20vbWFwcy9hcGkvc3RhdGljbWFwP1xyXG4gIGNlbnRlcj0ke2xvYy5sYXR9LCAke2xvYy5sbmd9XHJcbiAgJnpvb209MTJcclxuICAmc2l6ZT0yNDAweDI0MDBcclxuICAmbWFwdHlwZT1yb2FkbWFwXHJcbiAgJHttYXJrZXJzID8gbWFya2Vycy5tYXAobWFya2VyID0+IGAmbWFya2Vycz1jb2xvcjpyZWQlN0Mke21hcmtlci5sYXR9LCR7bWFya2VyLmxuZ31gKS5qb2luKCcnKSA6ICcnfVxyXG4gICZrZXk9QUl6YVN5QVhsT1RQendHckdMbFNOVDlJcGVZTzlvVHplRlBaN2EwYFxyXG5cclxuICBsZXQgaW1nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XHJcbiAgaW1nLnNyYyA9IHVybFxyXG4gIGltZy5zdHlsZVsnaGVpZ2h0J109JzEwMCUnXHJcbiAgaW1nLnN0eWxlWyd3aWR0aCddPScxMDAlJ1xyXG4gIGltZy5zdHlsZVsnb2JqZWN0LWZpdCddPSdjb3ZlcidcclxuXHJcbiAgY29uc3QgbWFwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI21hcCcpXHJcbiAgbWFwLmlubmVySFRNTCA9ICcnXHJcbiAgbWFwLmFwcGVuZENoaWxkKGltZylcclxufVxyXG4vKipcclxuICogSW5pdGlhbGl6ZSBHb29nbGUgbWFwLCBjYWxsZWQgZnJvbSBIVE1MLlxyXG4gKi9cclxud2luZG93LmluaXRNYXAgPSAoKSA9PiB7XHJcbiAgXHJcbiAgLy8gc2VsZi5tYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xyXG4gIC8vICAgem9vbTogMTIsXHJcbiAgLy8gICBjZW50ZXI6IGxvYyxcclxuICAvLyAgIHNjcm9sbHdoZWVsOiBmYWxzZVxyXG4gIC8vIH0pO1xyXG5cclxuICB1cGRhdGVNYXBQaWN0dXJlKCk7XHJcblxyXG4gIHVwZGF0ZVJlc3RhdXJhbnRzKCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBGZXRjaCBuZWlnaGJvcmhvb2RzIGFuZCBjdWlzaW5lcyBhcyBzb29uIGFzIHRoZSBwYWdlIGlzIGxvYWRlZC5cclxuICovXHJcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoZXZlbnQpID0+IHtcclxuICB3aW5kb3cudXBkYXRlUmVzdGF1cmFudHMgPSB1cGRhdGVSZXN0YXVyYW50cztcclxuICByZWdpc3RlclNlcnZpY2VXb3JrZXIoKTtcclxuICBmZXRjaE5laWdoYm9yaG9vZHMoKTtcclxuICBmZXRjaEN1aXNpbmVzKCk7XHJcbiAgXHJcbiAgb2JzZXJ2ZXIub2JzZXJ2ZSgpO1xyXG59KTsiLCIvKiEgbG96YWQuanMgLSB2MS40LjAgLSAyMDE4LTA0LTIyXG4qIGh0dHBzOi8vZ2l0aHViLmNvbS9BcG9vcnZTYXhlbmEvbG96YWQuanNcbiogQ29weXJpZ2h0IChjKSAyMDE4IEFwb29ydiBTYXhlbmE7IExpY2Vuc2VkIE1JVCAqL1xuXG5cbihmdW5jdGlvbiAoZ2xvYmFsLCBmYWN0b3J5KSB7XG5cdHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyA/IG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpIDpcblx0dHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kID8gZGVmaW5lKGZhY3RvcnkpIDpcblx0KGdsb2JhbC5sb3phZCA9IGZhY3RvcnkoKSk7XG59KHRoaXMsIChmdW5jdGlvbiAoKSB7ICd1c2Ugc3RyaWN0JztcblxudmFyIF9leHRlbmRzID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiAodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV07IGZvciAodmFyIGtleSBpbiBzb3VyY2UpIHsgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzb3VyY2UsIGtleSkpIHsgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsgfSB9IH0gcmV0dXJuIHRhcmdldDsgfTtcblxuLyoqXG4gKiBEZXRlY3QgSUUgYnJvd3NlclxuICogQGNvbnN0IHtib29sZWFufVxuICogQHByaXZhdGVcbiAqL1xudmFyIGlzSUUgPSBkb2N1bWVudC5kb2N1bWVudE1vZGU7XG5cbnZhciBkZWZhdWx0Q29uZmlnID0ge1xuICByb290TWFyZ2luOiAnMHB4JyxcbiAgdGhyZXNob2xkOiAwLFxuICBsb2FkOiBmdW5jdGlvbiBsb2FkKGVsZW1lbnQpIHtcbiAgICBpZiAoZWxlbWVudC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSAncGljdHVyZScpIHtcbiAgICAgIHZhciBpbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcbiAgICAgIGlmIChpc0lFICYmIGVsZW1lbnQuZ2V0QXR0cmlidXRlKCdkYXRhLWllc3JjJykpIHtcbiAgICAgICAgaW1nLnNyYyA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKCdkYXRhLWllc3JjJyk7XG4gICAgICB9XG4gICAgICBlbGVtZW50LmFwcGVuZENoaWxkKGltZyk7XG4gICAgfVxuICAgIGlmIChlbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS1zcmMnKSkge1xuICAgICAgZWxlbWVudC5zcmMgPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS1zcmMnKTtcbiAgICB9XG4gICAgaWYgKGVsZW1lbnQuZ2V0QXR0cmlidXRlKCdkYXRhLXNyY3NldCcpKSB7XG4gICAgICBlbGVtZW50LnNyY3NldCA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKCdkYXRhLXNyY3NldCcpO1xuICAgIH1cbiAgICBpZiAoZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2RhdGEtYmFja2dyb3VuZC1pbWFnZScpKSB7XG4gICAgICBlbGVtZW50LnN0eWxlLmJhY2tncm91bmRJbWFnZSA9ICd1cmwoXFwnJyArIGVsZW1lbnQuZ2V0QXR0cmlidXRlKCdkYXRhLWJhY2tncm91bmQtaW1hZ2UnKSArICdcXCcpJztcbiAgICB9XG4gIH0sXG4gIGxvYWRlZDogZnVuY3Rpb24gbG9hZGVkKCkge31cbn07XG5cbmZ1bmN0aW9uIG1hcmtBc0xvYWRlZChlbGVtZW50KSB7XG4gIGVsZW1lbnQuc2V0QXR0cmlidXRlKCdkYXRhLWxvYWRlZCcsIHRydWUpO1xufVxuXG52YXIgaXNMb2FkZWQgPSBmdW5jdGlvbiBpc0xvYWRlZChlbGVtZW50KSB7XG4gIHJldHVybiBlbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS1sb2FkZWQnKSA9PT0gJ3RydWUnO1xufTtcblxudmFyIG9uSW50ZXJzZWN0aW9uID0gZnVuY3Rpb24gb25JbnRlcnNlY3Rpb24obG9hZCwgbG9hZGVkKSB7XG4gIHJldHVybiBmdW5jdGlvbiAoZW50cmllcywgb2JzZXJ2ZXIpIHtcbiAgICBlbnRyaWVzLmZvckVhY2goZnVuY3Rpb24gKGVudHJ5KSB7XG4gICAgICBpZiAoZW50cnkuaW50ZXJzZWN0aW9uUmF0aW8gPiAwKSB7XG4gICAgICAgIG9ic2VydmVyLnVub2JzZXJ2ZShlbnRyeS50YXJnZXQpO1xuXG4gICAgICAgIGlmICghaXNMb2FkZWQoZW50cnkudGFyZ2V0KSkge1xuICAgICAgICAgIGxvYWQoZW50cnkudGFyZ2V0KTtcbiAgICAgICAgICBtYXJrQXNMb2FkZWQoZW50cnkudGFyZ2V0KTtcbiAgICAgICAgICBsb2FkZWQoZW50cnkudGFyZ2V0KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9O1xufTtcblxudmFyIGdldEVsZW1lbnRzID0gZnVuY3Rpb24gZ2V0RWxlbWVudHMoc2VsZWN0b3IpIHtcbiAgaWYgKHNlbGVjdG9yIGluc3RhbmNlb2YgRWxlbWVudCkge1xuICAgIHJldHVybiBbc2VsZWN0b3JdO1xuICB9XG4gIGlmIChzZWxlY3RvciBpbnN0YW5jZW9mIE5vZGVMaXN0KSB7XG4gICAgcmV0dXJuIHNlbGVjdG9yO1xuICB9XG4gIHJldHVybiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9yKTtcbn07XG5cbnZhciBsb3phZCA9IGZ1bmN0aW9uICgpIHtcbiAgdmFyIHNlbGVjdG9yID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiAnLmxvemFkJztcbiAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHt9O1xuXG4gIHZhciBfZGVmYXVsdENvbmZpZyRvcHRpb24gPSBfZXh0ZW5kcyh7fSwgZGVmYXVsdENvbmZpZywgb3B0aW9ucyksXG4gICAgICByb290TWFyZ2luID0gX2RlZmF1bHRDb25maWckb3B0aW9uLnJvb3RNYXJnaW4sXG4gICAgICB0aHJlc2hvbGQgPSBfZGVmYXVsdENvbmZpZyRvcHRpb24udGhyZXNob2xkLFxuICAgICAgbG9hZCA9IF9kZWZhdWx0Q29uZmlnJG9wdGlvbi5sb2FkLFxuICAgICAgbG9hZGVkID0gX2RlZmF1bHRDb25maWckb3B0aW9uLmxvYWRlZDtcblxuICB2YXIgb2JzZXJ2ZXIgPSB2b2lkIDA7XG5cbiAgaWYgKHdpbmRvdy5JbnRlcnNlY3Rpb25PYnNlcnZlcikge1xuICAgIG9ic2VydmVyID0gbmV3IEludGVyc2VjdGlvbk9ic2VydmVyKG9uSW50ZXJzZWN0aW9uKGxvYWQsIGxvYWRlZCksIHtcbiAgICAgIHJvb3RNYXJnaW46IHJvb3RNYXJnaW4sXG4gICAgICB0aHJlc2hvbGQ6IHRocmVzaG9sZFxuICAgIH0pO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBvYnNlcnZlOiBmdW5jdGlvbiBvYnNlcnZlKCkge1xuICAgICAgdmFyIGVsZW1lbnRzID0gZ2V0RWxlbWVudHMoc2VsZWN0b3IpO1xuXG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGlmIChpc0xvYWRlZChlbGVtZW50c1tpXSkpIHtcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAob2JzZXJ2ZXIpIHtcbiAgICAgICAgICBvYnNlcnZlci5vYnNlcnZlKGVsZW1lbnRzW2ldKTtcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICBsb2FkKGVsZW1lbnRzW2ldKTtcbiAgICAgICAgbWFya0FzTG9hZGVkKGVsZW1lbnRzW2ldKTtcbiAgICAgICAgbG9hZGVkKGVsZW1lbnRzW2ldKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHRyaWdnZXJMb2FkOiBmdW5jdGlvbiB0cmlnZ2VyTG9hZChlbGVtZW50KSB7XG4gICAgICBpZiAoaXNMb2FkZWQoZWxlbWVudCkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBsb2FkKGVsZW1lbnQpO1xuICAgICAgbWFya0FzTG9hZGVkKGVsZW1lbnQpO1xuICAgICAgbG9hZGVkKGVsZW1lbnQpO1xuICAgIH1cbiAgfTtcbn07XG5cbnJldHVybiBsb3phZDtcblxufSkpKTtcbiJdfQ=="}